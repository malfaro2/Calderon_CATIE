---
title: "Correlaciones de redundancia, uniqueness y Rao response traits"
author: "Erick Calder√≥n-Morales"
date: "March 25, 2019"
output:   
 html_document:
   code_folding: hide
   keep_md: yes
   toc: yes
   toc_depth: 2
   toc_float: yes
---

```{r message=FALSE, warning=FALSE}
#Paquetes
library(tidyverse)
library(PerformanceAnalytics)
library(janitor)
library(GGally)
source("C:/tesis_catie/Calderon_CATIE/scripts/functions/HighstatLibV10.R")
library(ggbiplot)
```



#Objetivo
Ver la correlacion existente entre las variables ambientales y los indices de redundancia, uniqueness y diversidad de Rao

```{r}
#Cargar datos
dredundancy_resp_sp <- read.csv("C:/tesis_catie/Calderon_CATIE/data/resultados_csv/data_indices_resp_redundancy_sp.csv", header=T)
dredundancy_resp_sp <- clean_names(dredundancy_resp_sp)

dparcelas <- read.csv("C:/tesis_catie/Calderon_CATIE/data/clean/data_posicion_parcelas.csv", header = T)
dparcelas <- clean_names(dparcelas)

denvi <- read.csv("C:/tesis_catie/Calderon_CATIE/data/clean/data_enviroment_worldclim_clean.csv", header = T)
denvi <- denvi %>%
  clean_names() %>% 
    select(-c(crtm_90_x,crtm_90_y)) 
```

```{r}
#Summary de los datos 
summary(dredundancy_resp_sp)
glimpse(dredundancy_resp_sp)
summary(dparcelas)
glimpse(dparcelas)
summary(denvi)
glimpse(denvi)
```

```{r}
dfull_resp_sp  <- left_join(dredundancy_resp_sp, dparcelas,by=c("plot") ) %>% 
  left_join(.,denvi, by=c("plot","forest_type") )

#Ordenar columnas
dfull_resp_sp <- dfull_resp_sp %>% select(plot, forest_type,n,longitude,latitude,crtm_90_x,crtm_90_y, everything()) 
glimpse(dfull_resp_sp)
```


#PCA con todas las variables
```{r fig.width=10, fig.height=8, fig.fullwidth=TRUE}
pca_full_resp_sp <- prcomp(dfull_resp_sp[,3:30], scale. = TRUE)
ggbiplot(pca_full_resp_sp, obs.scale = 3, var.scale = 3,
  groups = dfull_resp_sp$forest_type, ellipse = TRUE) +
  scale_color_discrete(name = '') +
  theme(legend.direction = 'horizontal', legend.position = 'top')+
  theme_grey()
```





```{r}
dfull2_sp  <- dfull_resp_sp %>% 
  select(-c(forest_type, plot,u, crtm_90_x,crtm_90_y, slope_deg, slope_per))

corvif(dfull2_sp)
```



##Variables independcientes que se van a eliminar

__Se excluyeron debido a que tienen un alto VIF, en el PCA tienen la misma direccion y por su correlacion__

+ sand        
+ elev 
+ mg
+ preccv
+ precdriest
+ tempmin
+ ca


```{r echo=T}

dfull_sin_variables_resp_sp <- dfull_resp_sp %>% 
  select(-c(forest_type, plot,u, crtm_90_x,crtm_90_y, slope_deg, slope_per,"sand","elev","mg","preccv","precdriest","tempmin","ca" ))
  
corvif(scale(dfull_sin_variables_resp_sp))
```

#Correlaciones para redundancia
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}
dredundancia_sp <- dfull_resp_sp %>% 
  select(-c(forest_type, plot,d,q,u, crtm_90_x,crtm_90_y, slope_deg, slope_per )) %>% 
  select(redundancy_sp, everything())
  
dredundancia_est <- scale(dredundancia_sp)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(dredundancia_est, histogram=TRUE, pch="+") 

```

#Correlaciones para uniqueness
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}
duniqueness <- dfull_resp_sp %>% 
  select(-c(forest_type, plot,d,q,redundancy_sp, crtm_90_x,crtm_90_y, slope_deg, slope_per )) %>% 
  select(u , everything())
  
duniqueness_est <- scale(duniqueness)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(duniqueness_est, histogram=TRUE, pch="+") 

```



#Correlaciones para Rao
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}

drao_sp <- dfull_resp_sp %>% 
  select(-c(forest_type, plot, d, u, redundancy_sp, crtm_90_x,crtm_90_y, slope_deg, slope_per)) %>% 
  select(q , everything())
  
drao_est_sp <- scale(drao_sp)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(drao_est_sp, histogram=TRUE, pch="+") 

```


```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}

dfull_sin_variables_sp <- dfull_sin_variables_resp_sp %>% 
  select(redundancy_sp, d, q, everything())

chart.Correlation(dfull_sin_variables_sp, histogram=TRUE, pch="+") 
```























