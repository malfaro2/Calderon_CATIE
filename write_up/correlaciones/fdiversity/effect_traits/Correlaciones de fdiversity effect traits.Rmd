---
title: "Correlaciones de FEve, Fdis , FDiv, effect traits"
author: "Erick Calder√≥n-Morales"
date: "March 25, 2019"
output:   
 html_document:
   code_folding: hide
   keep_md: yes
   toc: yes
   toc_depth: 2
   toc_float: yes
---

```{r message=FALSE, warning=FALSE}
#Paquetes
library(tidyverse)
library(PerformanceAnalytics)
library(janitor)
library(GGally)
source("C:/tesis_catie/Calderon_CATIE/scripts/functions/HighstatLibV10.R")
library(ggbiplot)
```



#Objetivo
Ver la correlacion existente entre las variables ambientales y los indices de redundancia, uniqueness y diversidad de Rao

```{r}
#Cargar datos
dfdiver <- read.csv("C:/tesis_catie/Calderon_CATIE/data/resultados_csv/data_indices_eff_fdiver.csv", header=T)
dfdiver <- clean_names(dfdiver)

dparcelas <- read.csv("C:/tesis_catie/Calderon_CATIE/data/clean/data_posicion_parcelas.csv", header = T)
dparcelas <- clean_names(dparcelas)

denvi <- read.csv("C:/tesis_catie/Calderon_CATIE/data/clean/data_enviroment_worldclim_clean.csv", header = T)
denvi <- denvi %>%
  clean_names() %>% 
    select(-c(crtm_90_x,crtm_90_y)) 
    
```

```{r}
#Summary de los datos 
summary(dfdiver)
glimpse(dfdiver)
summary(dparcelas)
glimpse(dparcelas)
summary(denvi)
glimpse(denvi)
```

```{r}
dfull  <- left_join(dfdiver, dparcelas,by=c("plot") ) %>% 
  left_join(.,denvi, by=c("plot","forest_type") )

#Ordenar columnas
dfull <- dfull %>% select(plot, forest_type,longitude,latitude,crtm_90_x,crtm_90_y, everything()) 
glimpse(dfull)
```


#PCA con todas las variables
```{r fig.width=10, fig.height=8, fig.fullwidth=TRUE}
pca_full <- prcomp(dfull[,3:28], scale. = TRUE)
ggbiplot(pca_full, obs.scale = 3, var.scale = 3,
  groups = dfull$forest_type, ellipse = TRUE) +
  scale_color_discrete(name = '') +
  theme(legend.direction = 'horizontal', legend.position = 'top')+
  theme_grey()
```





```{r}
dfull2  <- dfull %>% 
  select(-c(forest_type, plot, crtm_90_x,crtm_90_y, slope_deg, slope_per))

corvif(dfull2)
```



##Variables independcientes que se van a eliminar

__Se excluyeron debido a que tienen un alto VIF, en el PCA tienen la misma direccion y por su correlacion__

+ sand        
+ elev 
+ mg
+ preccv
+ precdriest
+ tempmin
+ ca


```{r echo=T}

dfull_sin_variables <- dfull %>% 
  select(-c(forest_type, plot, crtm_90_x,crtm_90_y, slope_deg, slope_per,"sand","elev","mg","preccv","precdriest","tempmin","ca" ))
  
corvif(scale(dfull_sin_variables))
```

#Correlaciones para feve
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}
dfeve <- dfull %>% 
  select(-c(forest_type, plot,fdis,fdiv, crtm_90_x,crtm_90_y, slope_deg, slope_per )) %>% 
  select(feve, everything())
  
dfeve_est <- scale(dfeve)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(dredundancia_est, histogram=TRUE, pch="+") 

```

#Correlaciones para fdis
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}
dfdis <- dfull %>% 
  select(-c(forest_type, plot,feve, fdiv, crtm_90_x,crtm_90_y, slope_deg, slope_per )) %>% 
  select(fdis , everything())
  
dfdis_est <- scale(dfdis)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(dfdis_est, histogram=TRUE, pch="+") 

```



#Correlaciones para fdiv
```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}

dfdiv <- dfull %>% 
  select(-c(forest_type, plot,feve,fdis, crtm_90_x,crtm_90_y, slope_deg, slope_per)) %>% 
  select(fdiv , everything())
  
dfdiv_est <- scale(dfdiv)

#ggpairs(dredundancia, lower=list(continuous="smooth"))
chart.Correlation(dfdiv_est, histogram=TRUE, pch="+") 

```


```{r fig.width=40, fig.height=40, results='asis', fig.fullwidth=TRUE}

dfull_sin_variables <- dfull_sin_variables %>% 
  select(fdis, feve, fdiv, everything())

chart.Correlation(dfull_sin_variables, histogram=TRUE, pch="+") 
```























